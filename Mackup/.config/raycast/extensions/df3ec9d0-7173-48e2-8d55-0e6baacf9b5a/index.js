"use strict";var Q=Object.create;var T=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(m,g)=>()=>(g||m((g={exports:{}}).exports,g),g.exports),re=(m,g)=>{for(var C in g)T(m,C,{get:g[C],enumerable:!0})},V=(m,g,C,v)=>{if(g&&typeof g=="object"||typeof g=="function")for(let e of z(g))!ee.call(m,e)&&e!==C&&T(m,e,{get:()=>g[e],enumerable:!(v=q(g,e))||v.enumerable});return m};var M=(m,g,C)=>(C=m!=null?Q(b(m)):{},V(g||!m||!m.__esModule?T(C,"default",{value:m,enumerable:!0}):C,m)),oe=m=>V(T({},"__esModule",{value:!0}),m);var _=te((fe,E)=>{(function(){"use strict";var m=typeof window=="object"?window:{},g=!m.HI_BASE32_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;g&&(m=global);var C=!m.HI_BASE32_NO_COMMON_JS&&typeof E=="object"&&E.exports,v=typeof define=="function"&&define.amd,e="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split(""),a={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,2:26,3:27,4:28,5:29,6:30,7:31},u=[0,0,0,0,0,0,0,0],w=function(t,i){i.length>10&&(i="..."+i.substr(-10));var o=new Error("Decoded data is not valid UTF-8. Maybe try base32.decode.asBytes()? Partial data after reading "+t+" bytes: "+i+" <-");throw o.position=t,o},D=function(t){for(var i="",o=t.length,n=0,s=0,h,c;n<o;){if(h=t[n++],h<=127){i+=String.fromCharCode(h);continue}else h>191&&h<=223?(c=h&31,s=1):h<=239?(c=h&15,s=2):h<=247?(c=h&7,s=3):w(n,i);for(var x=0;x<s;++x)h=t[n++],(h<128||h>191)&&w(n,i),c<<=6,c+=h&63;c>=55296&&c<=57343&&w(n,i),c>1114111&&w(n,i),c<=65535?i+=String.fromCharCode(c):(c-=65536,i+=String.fromCharCode((c>>10)+55296),i+=String.fromCharCode((c&1023)+56320))}return i},O=function(t){if(t==="")return[];if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");t=t.replace(/=/g,"");for(var i,o,n,s,h,c,x,f,A=[],d=0,F=t.length,l=0,y=F>>3<<3;l<y;)i=a[t.charAt(l++)],o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],c=a[t.charAt(l++)],x=a[t.charAt(l++)],f=a[t.charAt(l++)],A[d++]=(i<<3|o>>>2)&255,A[d++]=(o<<6|n<<1|s>>>4)&255,A[d++]=(s<<4|h>>>1)&255,A[d++]=(h<<7|c<<2|x>>>3)&255,A[d++]=(x<<5|f)&255;var P=F-y;return P===2?(i=a[t.charAt(l++)],o=a[t.charAt(l++)],A[d++]=(i<<3|o>>>2)&255):P===4?(i=a[t.charAt(l++)],o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],A[d++]=(i<<3|o>>>2)&255,A[d++]=(o<<6|n<<1|s>>>4)&255):P===5?(i=a[t.charAt(l++)],o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],A[d++]=(i<<3|o>>>2)&255,A[d++]=(o<<6|n<<1|s>>>4)&255,A[d++]=(s<<4|h>>>1)&255):P===7&&(i=a[t.charAt(l++)],o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],c=a[t.charAt(l++)],x=a[t.charAt(l++)],A[d++]=(i<<3|o>>>2)&255,A[d++]=(o<<6|n<<1|s>>>4)&255,A[d++]=(s<<4|h>>>1)&255,A[d++]=(h<<7|c<<2|x>>>3)&255),A},I=function(t){for(var i,o,n,s,h,c="",x=t.length,f=0,A=parseInt(x/5)*5;f<A;)i=t.charCodeAt(f++),o=t.charCodeAt(f++),n=t.charCodeAt(f++),s=t.charCodeAt(f++),h=t.charCodeAt(f++),c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[(s<<3|h>>>5)&31]+e[h&31];var d=x-A;return d===1?(i=t.charCodeAt(f),c+=e[i>>>3]+e[i<<2&31]+"======"):d===2?(i=t.charCodeAt(f++),o=t.charCodeAt(f),c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):d===3?(i=t.charCodeAt(f++),o=t.charCodeAt(f++),n=t.charCodeAt(f),c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[n<<1&31]+"==="):d===4&&(i=t.charCodeAt(f++),o=t.charCodeAt(f++),n=t.charCodeAt(f++),s=t.charCodeAt(f),c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[s<<3&31]+"="),c},B=function(t){var i,o,n,s,h,c,x=!1,f="",A=0,d,F=0,l=0,y=t.length;if(t==="")return f;do{for(u[0]=u[5],u[1]=u[6],u[2]=u[7],d=F;A<y&&d<5;++A)c=t.charCodeAt(A),c<128?u[d++]=c:c<2048?(u[d++]=192|c>>6,u[d++]=128|c&63):c<55296||c>=57344?(u[d++]=224|c>>12,u[d++]=128|c>>6&63,u[d++]=128|c&63):(c=65536+((c&1023)<<10|t.charCodeAt(++A)&1023),u[d++]=240|c>>18,u[d++]=128|c>>12&63,u[d++]=128|c>>6&63,u[d++]=128|c&63);l+=d-F,F=d-5,A===y&&++A,A>y&&d<6&&(x=!0),i=u[0],d>4?(o=u[1],n=u[2],s=u[3],h=u[4],f+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[(s<<3|h>>>5)&31]+e[h&31]):d===1?f+=e[i>>>3]+e[i<<2&31]+"======":d===2?(o=u[1],f+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):d===3?(o=u[1],n=u[2],f+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[n<<1&31]+"==="):(o=u[1],n=u[2],s=u[3],f+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[s<<3&31]+"=")}while(!x);return f},N=function(t){for(var i,o,n,s,h,c="",x=t.length,f=0,A=parseInt(x/5)*5;f<A;)i=t[f++],o=t[f++],n=t[f++],s=t[f++],h=t[f++],c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[(s<<3|h>>>5)&31]+e[h&31];var d=x-A;return d===1?(i=t[f],c+=e[i>>>3]+e[i<<2&31]+"======"):d===2?(i=t[f++],o=t[f],c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[o<<4&31]+"===="):d===3?(i=t[f++],o=t[f++],n=t[f],c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[n<<1&31]+"==="):d===4&&(i=t[f++],o=t[f++],n=t[f++],s=t[f],c+=e[i>>>3]+e[(i<<2|o>>>6)&31]+e[o>>>1&31]+e[(o<<4|n>>>4)&31]+e[(n<<1|s>>>7)&31]+e[s>>>2&31]+e[s<<3&31]+"="),c},j=function(t,i){var o=typeof t!="string";return o&&t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),o?N(t):i?I(t):B(t)},R=function(t,i){if(!i)return D(O(t));if(t==="")return"";if(!/^[A-Z2-7=]+$/.test(t))throw new Error("Invalid base32 characters");var o,n,s,h,c,x,f,A,d="",F=t.indexOf("=");F===-1&&(F=t.length);for(var l=0,y=F>>3<<3;l<y;)o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],c=a[t.charAt(l++)],x=a[t.charAt(l++)],f=a[t.charAt(l++)],A=a[t.charAt(l++)],d+=String.fromCharCode((o<<3|n>>>2)&255)+String.fromCharCode((n<<6|s<<1|h>>>4)&255)+String.fromCharCode((h<<4|c>>>1)&255)+String.fromCharCode((c<<7|x<<2|f>>>3)&255)+String.fromCharCode((f<<5|A)&255);var P=F-y;return P===2?(o=a[t.charAt(l++)],n=a[t.charAt(l++)],d+=String.fromCharCode((o<<3|n>>>2)&255)):P===4?(o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],d+=String.fromCharCode((o<<3|n>>>2)&255)+String.fromCharCode((n<<6|s<<1|h>>>4)&255)):P===5?(o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],c=a[t.charAt(l++)],d+=String.fromCharCode((o<<3|n>>>2)&255)+String.fromCharCode((n<<6|s<<1|h>>>4)&255)+String.fromCharCode((h<<4|c>>>1)&255)):P===7&&(o=a[t.charAt(l++)],n=a[t.charAt(l++)],s=a[t.charAt(l++)],h=a[t.charAt(l++)],c=a[t.charAt(l++)],x=a[t.charAt(l++)],f=a[t.charAt(l++)],d+=String.fromCharCode((o<<3|n>>>2)&255)+String.fromCharCode((n<<6|s<<1|h>>>4)&255)+String.fromCharCode((h<<4|c>>>1)&255)+String.fromCharCode((c<<7|x<<2|f>>>3)&255)),d},k={encode:j,decode:R};R.asBytes=O,C?E.exports=k:(m.base32=k,v&&define(function(){return k}))})()});var se={};re(se,{default:()=>S});module.exports=oe(se);var r=require("@raycast/api"),H=require("react"),L=M(_());var J=require("crypto"),G=M(_()),ie=[6,7,8],ne=["SHA1","SHA256","SHA512"];function K(m){return!!ne.find(g=>g===m)}function Z(m){return!!ie.find(g=>g==m)}function ae(m,g,C){let v=(0,J.createHmac)(C,m),e=Buffer.alloc(8);return e.writeBigInt64BE(g),v.update(e),v.digest()}function ce(m,g){let C=m[m.length-1]&15;return(m.slice(C,C+4).readUInt32BE()&2147483647)%Math.pow(10,g)}function W(m,g){let C=Math.floor(new Date().getTime()/1e3/g.period),v=G.decode.asBytes(m.toUpperCase());return ce(ae(Buffer.from(v),BigInt(C),g.algorithm),g.digits)}var $=require("url"),p=require("react/jsx-runtime"),U={digits:6,algorithm:"SHA1",period:30};function S(){let[m,g]=(0,H.useState)([]),{defaultAction:C}=(0,r.getPreferenceValues)();async function v(){let e=await r.LocalStorage.allItems();g(Object.keys(e).sort((a,u)=>a.localeCompare(u)).map(a=>{let u=le(e[a]);return{name:a,key:e[a].toString(),time:`${Math.floor(u.options.period-new Date().getTime()/1e3%u.options.period)}`,percent:Math.floor(u.options.period-new Date().getTime()/1e3%u.options.period)/u.options.period*100,code:W(u.secret,u.options).toString().padStart(u.options.digits,"0")}}))}return(0,H.useEffect)(()=>{v(),setInterval(()=>{v()},100)},[]),(0,p.jsx)(r.List,{actions:(0,p.jsxs)(r.ActionPanel,{children:[(0,p.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,p.jsx)(X,{}),shortcut:{modifiers:["cmd"],key:"enter"}}),(0,p.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App By URL",target:(0,p.jsx)(Y,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),children:m.map(e=>(0,p.jsx)(r.List.Item,{title:e.name,subtitle:e.code,accessories:[{icon:{source:+e.percent>75?r.Icon.CircleProgress100:+e.percent>50?r.Icon.CircleProgress75:+e.percent>25?r.Icon.CircleProgress50:+e.time>0?r.Icon.CircleProgress25:r.Icon.Circle},tooltip:e.time}],actions:(0,p.jsxs)(r.ActionPanel,{children:[(0,p.jsx)(r.ActionPanel.Section,{children:C=="copy"?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code"}),(0,p.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code"})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(r.Action.Paste,{content:e.code,title:"Paste Code"}),(0,p.jsx)(r.Action.CopyToClipboard,{content:e.code,title:"Copy Code"})]})}),(0,p.jsxs)(r.ActionPanel.Section,{children:[(0,p.jsx)(r.Action.Push,{icon:r.Icon.Plus,title:"Add App",target:(0,p.jsx)(X,{}),shortcut:{modifiers:["cmd"],key:"enter"}}),(0,p.jsx)(r.Action.Push,{icon:r.Icon.Link,title:"Add App By URL",target:(0,p.jsx)(Y,{}),shortcut:{modifiers:["cmd"],key:"u"}})]}),(0,p.jsx)(r.ActionPanel.Section,{children:(0,p.jsx)(r.Action,{icon:r.Icon.Trash,title:"Remove App",onAction:async()=>{await r.LocalStorage.removeItem(e.name),await v()},shortcut:{modifiers:["ctrl"],key:"return"}})})]})},e.name))})}function X(){let{push:m}=(0,r.useNavigation)(),g=async C=>{let v=C;if(!v.name||!v.secret){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}if(v.secret=v.secret.replace(/[-\s]/g,"").toUpperCase(),await r.LocalStorage.getItem(v.name)){(0,r.showToast)(r.Toast.Style.Failure,"This app name is already taken");return}try{L.decode.asBytes(v.secret)}catch{(0,r.showToast)(r.Toast.Style.Failure,"Invalid 2FA secret");return}if(isNaN(v.period)){(0,r.showToast)(r.Toast.Style.Failure,"Period should be a number");return}if(+v.period<=0){(0,r.showToast)(r.Toast.Style.Failure,"Period should be positive number");return}let e={digits:v.digits,period:v.period,algorithm:v.algorithm};await r.LocalStorage.setItem(v.name,JSON.stringify({secret:v.secret,options:e})),m((0,p.jsx)(S,{}))};return(0,p.jsxs)(r.Form,{actions:(0,p.jsx)(r.ActionPanel,{children:(0,p.jsx)(r.Action.SubmitForm,{icon:r.Icon.Plus,title:"Submit",onSubmit:g})}),children:[(0,p.jsx)(r.Form.TextField,{id:"name",title:"App Name",placeholder:"e.g. GitHub"}),(0,p.jsx)(r.Form.TextField,{id:"secret",title:"2FA Secret",placeholder:"Get this from your provider"}),(0,p.jsx)(r.Form.TextField,{id:"period",title:"Period",placeholder:"A period that a TOTP code will be valid for",defaultValue:"30"}),(0,p.jsxs)(r.Form.Dropdown,{id:"digits",title:"Digits count",defaultValue:"6",children:[(0,p.jsx)(r.Form.Dropdown.Item,{title:"6",value:"6"}),(0,p.jsx)(r.Form.Dropdown.Item,{title:"7",value:"7"}),(0,p.jsx)(r.Form.Dropdown.Item,{title:"8",value:"8"})]}),(0,p.jsxs)(r.Form.Dropdown,{id:"algorithm",title:"Algorithm",defaultValue:"SHA1",children:[(0,p.jsx)(r.Form.Dropdown.Item,{title:"SHA1",value:"SHA1"}),(0,p.jsx)(r.Form.Dropdown.Item,{title:"SHA256",value:"SHA256"}),(0,p.jsx)(r.Form.Dropdown.Item,{title:"SHA512",value:"SHA512"})]})]})}function Y(){let{push:m}=(0,r.useNavigation)(),g=async C=>{let{url:v}=C;if(!v){(0,r.showToast)(r.Toast.Style.Failure,"Please provide both fields");return}try{let e=new $.URL(v);if(e.protocol!="otpauth:"){(0,r.showToast)(r.Toast.Style.Failure,"Unsupported protocol "+e.protocol);return}if(e.host!="totp"){(0,r.showToast)(r.Toast.Style.Failure,"Unsupported type "+e.host+" only TOTP supported");return}if(!e.pathname){(0,r.showToast)(r.Toast.Style.Failure,"Label is missing");return}let a=decodeURIComponent(e.pathname.slice(1)),u=e.searchParams,w=u.get("secret"),D=u.get("algorithm")?u.get("algorithm"):U.algorithm,O=u.get("period"),I=O?parseInt(O):U.period,B=u.get("digits")?u.get("digits"):U.digits;if(!w){(0,r.showToast)(r.Toast.Style.Failure,"Secret is mandatory");return}try{L.decode.asBytes(w)}catch{(0,r.showToast)(r.Toast.Style.Failure,"Invalid 2FA secret");return}if(!K(D)){(0,r.showToast)(r.Toast.Style.Failure,"Unsupported hashing algorithm "+D);return}if(isNaN(I)){(0,r.showToast)(r.Toast.Style.Failure,"Period should be a number");return}if(+I<=0){(0,r.showToast)(r.Toast.Style.Failure,"Period should be positive number");return}if(!Z(B)){(0,r.showToast)(r.Toast.Style.Failure,"Unsupported digits "+B);return}let N={digits:B,period:I,algorithm:D};await r.LocalStorage.setItem(a,JSON.stringify({secret:w,options:N})),m((0,p.jsx)(S,{}))}catch{(0,r.showToast)(r.Toast.Style.Failure,"Unable to parse URL");return}m((0,p.jsx)(S,{}))};return(0,p.jsx)(r.Form,{actions:(0,p.jsx)(r.ActionPanel,{children:(0,p.jsx)(r.Action.SubmitForm,{title:"Submit",onSubmit:g})}),children:(0,p.jsx)(r.Form.TextArea,{id:"url",title:"Otpauth URL",placeholder:"e.g. otpauth://totp/Example:alice@google.com?secret=JBSWY3DPEHPK3PXP&issuer=Example"})})}function le(m){try{return JSON.parse(m)}catch{return{secret:m,options:U}}}0&&(module.exports={});
/*
 * [hi-base32]{@link https://github.com/emn178/hi-base32}
 *
 * @version 0.5.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2018
 * @license MIT
 */
